

# Open datafile in Spark database

scala> val dataframe = spark.read.format("csv").option("header", "true").load("hdfs://localhost:54310/tfl-data/unzipped")


# Create temporary dataframe called "tfldataset"

scala> dataframe.createTempView("tfldataset")


# Get number of unique users in Spark Database:

scala> val sqlFrame = spark.sql("SELECT COUNT(DISTINCT PRESTIGEID) FROM tfldataset")

scala> sqlFrame.show(200)



# Get frequency distribution of journeys based on age group (as recorded by TfL)

scala> val sqlFrame = spark.sql("SELECT PPTPASSENGERAGEKEY, COUNT(PPTPASSENGERAGEKEY) Frequency, COUNT(PPTPASSENGERAGEKEY)/(SELECT COUNT(PPTPASSENGERAGEKEY) FROM tfldataset)*100 Percentage FROM tfldataset GROUP BY PPTPASSENGERAGEKEY ORDER BY Frequency DESC")

scala> sqlFrame.show(200)


# Get frequency distribution of journeys based on date

scala> val sqlFrame = spark.sql("SELECT DAYKEY, COUNT(DAYKEY) Frequency, COUNT(DAYKEY)/(SELECT COUNT(DAYKEY) FROM tfldataset)*100 Percentage FROM tfldataset GROUP BY DAYKEY ORDER BY Frequency DESC")

scala> sqlFrame.show(200)


# Get frequency distribution of journeys based on card type

scala> val sqlFrame = spark.sql("SELECT CARDTYPEKEY, COUNT(CARDTYPEKEY) Frequency, COUNT(CARDTYPEKEY)/(SELECT COUNT(CARDTYPEKEY) FROM tfldataset)*100 Percentage FROM tfldataset GROUP BY CARDTYPEKEY ORDER BY Frequency DESC")

scala> sqlFrame.show(200)


# Get distribution of travel times throughout the course of a day

# Note: TRANSACTIONTIME refers to number of minutes past midnight

scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 0 AND TRANSACTIONTIME < 120")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 120 AND TRANSACTIONTIME < 240")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 240 AND TRANSACTIONTIME < 360")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 360 AND TRANSACTIONTIME < 480")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 480 AND TRANSACTIONTIME < 600")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 600 AND TRANSACTIONTIME < 720")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 720 AND TRANSACTIONTIME < 840")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 840 AND TRANSACTIONTIME < 960")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 960 AND TRANSACTIONTIME < 1080")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 1080 AND TRANSACTIONTIME < 1200")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 1200 AND TRANSACTIONTIME < 1320")

scala> sqlFrame.show(200)


scala> val sqlFrame = spark.sql("SELECT COUNT(*) FROM tfldataset WHERE TRANSACTIONTIME >= 1320 AND TRANSACTIONTIME < 1440")

scala> sqlFrame.show(200)



# Create a filtered dataframe from the entire TfL dataset in the Spark database. This filtered dataframe only uses the fields we are
# interested in, including the unique Oyster card identification number, the passenger's age (based on the information on the Oyster
# card, the date on which the journey took place, the type of Oyster card used, the station of entry, the station exit, and the time 
# at which the journey took place. Furthermore, we filter out journeys where the station of entry is unknown.

scala> val sqlFrame = spark.sql("CREATE TABLE tfl_stage_1 SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfldataset WHERE STATIONOFFIRSTENTRYKEY != '-1'")


# Now we create a further filter where we only want records pertaining to journeys which commence at one of the known tube or rail stations
# end in one of the known tube or rail stations (or end in an unknown station).


scala> val sqlFrame = spark.sql("CREATE TABLE tfl_stage_2 SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_stage_1 WHERE (STATIONOFFIRSTENTRYKEY LIKE '1' OR STATIONOFFIRSTENTRYKEY LIKE '2' OR STATIONOFFIRSTENTRYKEY LIKE '3' OR STATIONOFFIRSTENTRYKEY LIKE '4' OR STATIONOFFIRSTENTRYKEY LIKE '5' OR STATIONOFFIRSTENTRYKEY LIKE '6' OR STATIONOFFIRSTENTRYKEY LIKE '7' OR STATIONOFFIRSTENTRYKEY LIKE '8' OR STATIONOFFIRSTENTRYKEY LIKE '9' OR STATIONOFFIRSTENTRYKEY LIKE '10' OR STATIONOFFIRSTENTRYKEY LIKE '11' OR STATIONOFFIRSTENTRYKEY LIKE '12' OR STATIONOFFIRSTENTRYKEY LIKE '13' OR STATIONOFFIRSTENTRYKEY LIKE '14' OR STATIONOFFIRSTENTRYKEY LIKE '15' OR STATIONOFFIRSTENTRYKEY LIKE '16' OR STATIONOFFIRSTENTRYKEY LIKE '17' OR STATIONOFFIRSTENTRYKEY LIKE '18' OR STATIONOFFIRSTENTRYKEY LIKE '19' OR STATIONOFFIRSTENTRYKEY LIKE '20' OR STATIONOFFIRSTENTRYKEY LIKE '21' OR STATIONOFFIRSTENTRYKEY LIKE '22' OR STATIONOFFIRSTENTRYKEY LIKE '23' OR STATIONOFFIRSTENTRYKEY LIKE '24' OR STATIONOFFIRSTENTRYKEY LIKE '25' OR STATIONOFFIRSTENTRYKEY LIKE '26' OR STATIONOFFIRSTENTRYKEY LIKE '27' OR STATIONOFFIRSTENTRYKEY LIKE '28' OR STATIONOFFIRSTENTRYKEY LIKE '30' OR STATIONOFFIRSTENTRYKEY LIKE '31' OR STATIONOFFIRSTENTRYKEY LIKE '32' OR STATIONOFFIRSTENTRYKEY LIKE '33' OR STATIONOFFIRSTENTRYKEY LIKE '34' OR STATIONOFFIRSTENTRYKEY LIKE '35' OR STATIONOFFIRSTENTRYKEY LIKE '36' OR STATIONOFFIRSTENTRYKEY LIKE '37' OR STATIONOFFIRSTENTRYKEY LIKE '38' OR STATIONOFFIRSTENTRYKEY LIKE '39' OR STATIONOFFIRSTENTRYKEY LIKE '40' OR STATIONOFFIRSTENTRYKEY LIKE '41' OR STATIONOFFIRSTENTRYKEY LIKE '42' OR STATIONOFFIRSTENTRYKEY LIKE '43' OR STATIONOFFIRSTENTRYKEY LIKE '44' OR STATIONOFFIRSTENTRYKEY LIKE '45' OR STATIONOFFIRSTENTRYKEY LIKE '46' OR STATIONOFFIRSTENTRYKEY LIKE '47' OR STATIONOFFIRSTENTRYKEY LIKE '48' OR STATIONOFFIRSTENTRYKEY LIKE '49' OR STATIONOFFIRSTENTRYKEY LIKE '50' OR STATIONOFFIRSTENTRYKEY LIKE '51' OR STATIONOFFIRSTENTRYKEY LIKE '52' OR STATIONOFFIRSTENTRYKEY LIKE '53' OR STATIONOFFIRSTENTRYKEY LIKE '54' OR STATIONOFFIRSTENTRYKEY LIKE '55' OR STATIONOFFIRSTENTRYKEY LIKE '56' OR STATIONOFFIRSTENTRYKEY LIKE '57' OR STATIONOFFIRSTENTRYKEY LIKE '59' OR STATIONOFFIRSTENTRYKEY LIKE '60' OR STATIONOFFIRSTENTRYKEY LIKE '61' OR STATIONOFFIRSTENTRYKEY LIKE '62' OR STATIONOFFIRSTENTRYKEY LIKE '63' OR STATIONOFFIRSTENTRYKEY LIKE '64' OR STATIONOFFIRSTENTRYKEY LIKE '65' OR STATIONOFFIRSTENTRYKEY LIKE '66' OR STATIONOFFIRSTENTRYKEY LIKE '67' OR STATIONOFFIRSTENTRYKEY LIKE '68' OR STATIONOFFIRSTENTRYKEY LIKE '69' OR STATIONOFFIRSTENTRYKEY LIKE '70' OR STATIONOFFIRSTENTRYKEY LIKE '71' OR STATIONOFFIRSTENTRYKEY LIKE '72' OR STATIONOFFIRSTENTRYKEY LIKE '73' OR STATIONOFFIRSTENTRYKEY LIKE '74' OR STATIONOFFIRSTENTRYKEY LIKE '76' OR STATIONOFFIRSTENTRYKEY LIKE '77' OR STATIONOFFIRSTENTRYKEY LIKE '78' OR STATIONOFFIRSTENTRYKEY LIKE '79' OR STATIONOFFIRSTENTRYKEY LIKE '80' OR STATIONOFFIRSTENTRYKEY LIKE '81' OR STATIONOFFIRSTENTRYKEY LIKE '82' OR STATIONOFFIRSTENTRYKEY LIKE '83' OR STATIONOFFIRSTENTRYKEY LIKE '84' OR STATIONOFFIRSTENTRYKEY LIKE '85' OR STATIONOFFIRSTENTRYKEY LIKE '86' OR STATIONOFFIRSTENTRYKEY LIKE '87' OR STATIONOFFIRSTENTRYKEY LIKE '88' OR STATIONOFFIRSTENTRYKEY LIKE '89' OR STATIONOFFIRSTENTRYKEY LIKE '90' OR STATIONOFFIRSTENTRYKEY LIKE '92' OR STATIONOFFIRSTENTRYKEY LIKE '93' OR STATIONOFFIRSTENTRYKEY LIKE '94' OR STATIONOFFIRSTENTRYKEY LIKE '95' OR STATIONOFFIRSTENTRYKEY LIKE '96' OR STATIONOFFIRSTENTRYKEY LIKE '97' OR STATIONOFFIRSTENTRYKEY LIKE '98' OR STATIONOFFIRSTENTRYKEY LIKE '99' OR STATIONOFFIRSTENTRYKEY LIKE '100' OR STATIONOFFIRSTENTRYKEY LIKE '101' OR STATIONOFFIRSTENTRYKEY LIKE '102' OR STATIONOFFIRSTENTRYKEY LIKE '103' OR STATIONOFFIRSTENTRYKEY LIKE '104' OR STATIONOFFIRSTENTRYKEY LIKE '105' OR STATIONOFFIRSTENTRYKEY LIKE '106' OR STATIONOFFIRSTENTRYKEY LIKE '107' OR STATIONOFFIRSTENTRYKEY LIKE '109' OR STATIONOFFIRSTENTRYKEY LIKE '110' OR STATIONOFFIRSTENTRYKEY LIKE '111' OR STATIONOFFIRSTENTRYKEY LIKE '112' OR STATIONOFFIRSTENTRYKEY LIKE '113' OR STATIONOFFIRSTENTRYKEY LIKE '115' OR STATIONOFFIRSTENTRYKEY LIKE '116' OR STATIONOFFIRSTENTRYKEY LIKE '117' OR STATIONOFFIRSTENTRYKEY LIKE '118' OR STATIONOFFIRSTENTRYKEY LIKE '119' OR STATIONOFFIRSTENTRYKEY LIKE '120' OR STATIONOFFIRSTENTRYKEY LIKE '121' OR STATIONOFFIRSTENTRYKEY LIKE '122' OR STATIONOFFIRSTENTRYKEY LIKE '123' OR STATIONOFFIRSTENTRYKEY LIKE '124' OR STATIONOFFIRSTENTRYKEY LIKE '125' OR STATIONOFFIRSTENTRYKEY LIKE '126' OR STATIONOFFIRSTENTRYKEY LIKE '127' OR STATIONOFFIRSTENTRYKEY LIKE '128' OR STATIONOFFIRSTENTRYKEY LIKE '129' OR STATIONOFFIRSTENTRYKEY LIKE '130' OR STATIONOFFIRSTENTRYKEY LIKE '131' OR STATIONOFFIRSTENTRYKEY LIKE '132' OR STATIONOFFIRSTENTRYKEY LIKE '133' OR STATIONOFFIRSTENTRYKEY LIKE '134' OR STATIONOFFIRSTENTRYKEY LIKE '135' OR STATIONOFFIRSTENTRYKEY LIKE '136' OR STATIONOFFIRSTENTRYKEY LIKE '137' OR STATIONOFFIRSTENTRYKEY LIKE '138' OR STATIONOFFIRSTENTRYKEY LIKE '139' OR STATIONOFFIRSTENTRYKEY LIKE '141' OR STATIONOFFIRSTENTRYKEY LIKE '142' OR STATIONOFFIRSTENTRYKEY LIKE '143' OR STATIONOFFIRSTENTRYKEY LIKE '144' OR STATIONOFFIRSTENTRYKEY LIKE '145' OR STATIONOFFIRSTENTRYKEY LIKE '146' OR STATIONOFFIRSTENTRYKEY LIKE '147' OR STATIONOFFIRSTENTRYKEY LIKE '148' OR STATIONOFFIRSTENTRYKEY LIKE '149' OR STATIONOFFIRSTENTRYKEY LIKE '150' OR STATIONOFFIRSTENTRYKEY LIKE '151' OR STATIONOFFIRSTENTRYKEY LIKE '152' OR STATIONOFFIRSTENTRYKEY LIKE '153' OR STATIONOFFIRSTENTRYKEY LIKE '154' OR STATIONOFFIRSTENTRYKEY LIKE '155' OR STATIONOFFIRSTENTRYKEY LIKE '156' OR STATIONOFFIRSTENTRYKEY LIKE '157' OR STATIONOFFIRSTENTRYKEY LIKE '158' OR STATIONOFFIRSTENTRYKEY LIKE '159' OR STATIONOFFIRSTENTRYKEY LIKE '160' OR STATIONOFFIRSTENTRYKEY LIKE '161' OR STATIONOFFIRSTENTRYKEY LIKE '162' OR STATIONOFFIRSTENTRYKEY LIKE '163' OR STATIONOFFIRSTENTRYKEY LIKE '164' OR STATIONOFFIRSTENTRYKEY LIKE '166' OR STATIONOFFIRSTENTRYKEY LIKE '167' OR STATIONOFFIRSTENTRYKEY LIKE '168' OR STATIONOFFIRSTENTRYKEY LIKE '169' OR STATIONOFFIRSTENTRYKEY LIKE '171' OR STATIONOFFIRSTENTRYKEY LIKE '172' OR STATIONOFFIRSTENTRYKEY LIKE '173' OR STATIONOFFIRSTENTRYKEY LIKE '175' OR STATIONOFFIRSTENTRYKEY LIKE '176' OR STATIONOFFIRSTENTRYKEY LIKE '177' OR STATIONOFFIRSTENTRYKEY LIKE '178' OR STATIONOFFIRSTENTRYKEY LIKE '179' OR STATIONOFFIRSTENTRYKEY LIKE '183' OR STATIONOFFIRSTENTRYKEY LIKE '187' OR STATIONOFFIRSTENTRYKEY LIKE '188' OR STATIONOFFIRSTENTRYKEY LIKE '189' OR STATIONOFFIRSTENTRYKEY LIKE '190' OR STATIONOFFIRSTENTRYKEY LIKE '191' OR STATIONOFFIRSTENTRYKEY LIKE '192' OR STATIONOFFIRSTENTRYKEY LIKE '193' OR STATIONOFFIRSTENTRYKEY LIKE '194' OR STATIONOFFIRSTENTRYKEY LIKE '195' OR STATIONOFFIRSTENTRYKEY LIKE '196' OR STATIONOFFIRSTENTRYKEY LIKE '197' OR STATIONOFFIRSTENTRYKEY LIKE '198' OR STATIONOFFIRSTENTRYKEY LIKE '199' OR STATIONOFFIRSTENTRYKEY LIKE '200' OR STATIONOFFIRSTENTRYKEY LIKE '201' OR STATIONOFFIRSTENTRYKEY LIKE '202' OR STATIONOFFIRSTENTRYKEY LIKE '203' OR STATIONOFFIRSTENTRYKEY LIKE '205' OR STATIONOFFIRSTENTRYKEY LIKE '206' OR STATIONOFFIRSTENTRYKEY LIKE '207' OR STATIONOFFIRSTENTRYKEY LIKE '208' OR STATIONOFFIRSTENTRYKEY LIKE '209' OR STATIONOFFIRSTENTRYKEY LIKE '210' OR STATIONOFFIRSTENTRYKEY LIKE '211' OR STATIONOFFIRSTENTRYKEY LIKE '213' OR STATIONOFFIRSTENTRYKEY LIKE '214' OR STATIONOFFIRSTENTRYKEY LIKE '215' OR STATIONOFFIRSTENTRYKEY LIKE '216' OR STATIONOFFIRSTENTRYKEY LIKE '217' OR STATIONOFFIRSTENTRYKEY LIKE '218' OR STATIONOFFIRSTENTRYKEY LIKE '219' OR STATIONOFFIRSTENTRYKEY LIKE '220' OR STATIONOFFIRSTENTRYKEY LIKE '221' OR STATIONOFFIRSTENTRYKEY LIKE '222' OR STATIONOFFIRSTENTRYKEY LIKE '223' OR STATIONOFFIRSTENTRYKEY LIKE '224' OR STATIONOFFIRSTENTRYKEY LIKE '225' OR STATIONOFFIRSTENTRYKEY LIKE '227' OR STATIONOFFIRSTENTRYKEY LIKE '228' OR STATIONOFFIRSTENTRYKEY LIKE '229' OR STATIONOFFIRSTENTRYKEY LIKE '231' OR STATIONOFFIRSTENTRYKEY LIKE '232' OR STATIONOFFIRSTENTRYKEY LIKE '233' OR STATIONOFFIRSTENTRYKEY LIKE '234' OR STATIONOFFIRSTENTRYKEY LIKE '235' OR STATIONOFFIRSTENTRYKEY LIKE '236' OR STATIONOFFIRSTENTRYKEY LIKE '237' OR STATIONOFFIRSTENTRYKEY LIKE '238' OR STATIONOFFIRSTENTRYKEY LIKE '239' OR STATIONOFFIRSTENTRYKEY LIKE '240' OR STATIONOFFIRSTENTRYKEY LIKE '241' OR STATIONOFFIRSTENTRYKEY LIKE '242' OR STATIONOFFIRSTENTRYKEY LIKE '243' OR STATIONOFFIRSTENTRYKEY LIKE '244' OR STATIONOFFIRSTENTRYKEY LIKE '245' OR STATIONOFFIRSTENTRYKEY LIKE '246' OR STATIONOFFIRSTENTRYKEY LIKE '247' OR STATIONOFFIRSTENTRYKEY LIKE '248' OR STATIONOFFIRSTENTRYKEY LIKE '249' OR STATIONOFFIRSTENTRYKEY LIKE '251' OR STATIONOFFIRSTENTRYKEY LIKE '252' OR STATIONOFFIRSTENTRYKEY LIKE '254' OR STATIONOFFIRSTENTRYKEY LIKE '255' OR STATIONOFFIRSTENTRYKEY LIKE '256' OR STATIONOFFIRSTENTRYKEY LIKE '257' OR STATIONOFFIRSTENTRYKEY LIKE '261' OR STATIONOFFIRSTENTRYKEY LIKE '262' OR STATIONOFFIRSTENTRYKEY LIKE '263' OR STATIONOFFIRSTENTRYKEY LIKE '264' OR STATIONOFFIRSTENTRYKEY LIKE '267' OR STATIONOFFIRSTENTRYKEY LIKE '268' OR STATIONOFFIRSTENTRYKEY LIKE '269' OR STATIONOFFIRSTENTRYKEY LIKE '284' OR STATIONOFFIRSTENTRYKEY LIKE '299' OR STATIONOFFIRSTENTRYKEY LIKE '302' OR STATIONOFFIRSTENTRYKEY LIKE '303' OR STATIONOFFIRSTENTRYKEY LIKE '318' OR STATIONOFFIRSTENTRYKEY LIKE '336' OR STATIONOFFIRSTENTRYKEY LIKE '338' OR STATIONOFFIRSTENTRYKEY LIKE '373' OR STATIONOFFIRSTENTRYKEY LIKE '384' OR STATIONOFFIRSTENTRYKEY LIKE '393' OR STATIONOFFIRSTENTRYKEY LIKE '402' OR STATIONOFFIRSTENTRYKEY LIKE '431' OR STATIONOFFIRSTENTRYKEY LIKE '449' OR STATIONOFFIRSTENTRYKEY LIKE '454' OR STATIONOFFIRSTENTRYKEY LIKE '462' OR STATIONOFFIRSTENTRYKEY LIKE '463' OR STATIONOFFIRSTENTRYKEY LIKE '489' OR STATIONOFFIRSTENTRYKEY LIKE '493' OR STATIONOFFIRSTENTRYKEY LIKE '521' OR STATIONOFFIRSTENTRYKEY LIKE '526' OR STATIONOFFIRSTENTRYKEY LIKE '538' OR STATIONOFFIRSTENTRYKEY LIKE '587' OR STATIONOFFIRSTENTRYKEY LIKE '602' OR STATIONOFFIRSTENTRYKEY LIKE '606' OR STATIONOFFIRSTENTRYKEY LIKE '608' OR STATIONOFFIRSTENTRYKEY LIKE '610' OR STATIONOFFIRSTENTRYKEY LIKE '643' OR STATIONOFFIRSTENTRYKEY LIKE '644' OR STATIONOFFIRSTENTRYKEY LIKE '662' OR STATIONOFFIRSTENTRYKEY LIKE '670' OR STATIONOFFIRSTENTRYKEY LIKE '671' OR STATIONOFFIRSTENTRYKEY LIKE '691' OR STATIONOFFIRSTENTRYKEY LIKE '701' OR STATIONOFFIRSTENTRYKEY LIKE '708' OR STATIONOFFIRSTENTRYKEY LIKE '717' OR STATIONOFFIRSTENTRYKEY LIKE '744' OR STATIONOFFIRSTENTRYKEY LIKE '745' OR STATIONOFFIRSTENTRYKEY LIKE '752' OR STATIONOFFIRSTENTRYKEY LIKE '765' OR STATIONOFFIRSTENTRYKEY LIKE '789' OR STATIONOFFIRSTENTRYKEY LIKE '791' OR STATIONOFFIRSTENTRYKEY LIKE '822' OR STATIONOFFIRSTENTRYKEY LIKE '825' OR STATIONOFFIRSTENTRYKEY LIKE '861' OR STATIONOFFIRSTENTRYKEY LIKE '870' OR STATIONOFFIRSTENTRYKEY LIKE '871' OR STATIONOFFIRSTENTRYKEY LIKE '872' OR STATIONOFFIRSTENTRYKEY LIKE '876' OR STATIONOFFIRSTENTRYKEY LIKE '882' OR STATIONOFFIRSTENTRYKEY LIKE '903' OR STATIONOFFIRSTENTRYKEY LIKE '910' OR STATIONOFFIRSTENTRYKEY LIKE '915' OR STATIONOFFIRSTENTRYKEY LIKE '918' OR STATIONOFFIRSTENTRYKEY LIKE '930' OR STATIONOFFIRSTENTRYKEY LIKE '932' OR STATIONOFFIRSTENTRYKEY LIKE '974' OR STATIONOFFIRSTENTRYKEY LIKE '981' OR STATIONOFFIRSTENTRYKEY LIKE '1123' OR STATIONOFFIRSTENTRYKEY LIKE '1124' OR STATIONOFFIRSTENTRYKEY LIKE '1293' OR STATIONOFFIRSTENTRYKEY LIKE '1294' OR STATIONOFFIRSTENTRYKEY LIKE '1295' OR STATIONOFFIRSTENTRYKEY LIKE '1335' OR STATIONOFFIRSTENTRYKEY LIKE '1337' OR STATIONOFFIRSTENTRYKEY LIKE '1338' OR STATIONOFFIRSTENTRYKEY LIKE '1339' OR STATIONOFFIRSTENTRYKEY LIKE '1341' OR STATIONOFFIRSTENTRYKEY LIKE '1342' OR STATIONOFFIRSTENTRYKEY LIKE '1343' OR STATIONOFFIRSTENTRYKEY LIKE '1345' OR STATIONOFFIRSTENTRYKEY LIKE '1348' OR STATIONOFFIRSTENTRYKEY LIKE '1349' OR STATIONOFFIRSTENTRYKEY LIKE '1350' OR STATIONOFFIRSTENTRYKEY LIKE '1351' OR STATIONOFFIRSTENTRYKEY LIKE '1352' OR STATIONOFFIRSTENTRYKEY LIKE '1355' OR STATIONOFFIRSTENTRYKEY LIKE '1356' OR STATIONOFFIRSTENTRYKEY LIKE '1357' OR STATIONOFFIRSTENTRYKEY LIKE '1365' OR STATIONOFFIRSTENTRYKEY LIKE '1366' OR STATIONOFFIRSTENTRYKEY LIKE '1367' OR STATIONOFFIRSTENTRYKEY LIKE '1368' OR STATIONOFFIRSTENTRYKEY LIKE '1371' OR STATIONOFFIRSTENTRYKEY LIKE '1378' OR STATIONOFFIRSTENTRYKEY LIKE '1409' OR STATIONOFFIRSTENTRYKEY LIKE '1486' OR STATIONOFFIRSTENTRYKEY LIKE '1510' OR STATIONOFFIRSTENTRYKEY LIKE '1521' OR STATIONOFFIRSTENTRYKEY LIKE '1572' OR STATIONOFFIRSTENTRYKEY LIKE '1577' OR STATIONOFFIRSTENTRYKEY LIKE '1615' OR STATIONOFFIRSTENTRYKEY LIKE '1616' OR STATIONOFFIRSTENTRYKEY LIKE '1617' OR STATIONOFFIRSTENTRYKEY LIKE '1618' OR STATIONOFFIRSTENTRYKEY LIKE '1619' OR STATIONOFFIRSTENTRYKEY LIKE '1620' OR STATIONOFFIRSTENTRYKEY LIKE '1679' OR STATIONOFFIRSTENTRYKEY LIKE '1680' OR STATIONOFFIRSTENTRYKEY LIKE '1681' OR STATIONOFFIRSTENTRYKEY LIKE '1682' OR STATIONOFFIRSTENTRYKEY LIKE '1683' OR STATIONOFFIRSTENTRYKEY LIKE '1685' OR STATIONOFFIRSTENTRYKEY LIKE '1686' OR STATIONOFFIRSTENTRYKEY LIKE '1688' OR STATIONOFFIRSTENTRYKEY LIKE '1731' OR STATIONOFFIRSTENTRYKEY LIKE '1946' OR STATIONOFFIRSTENTRYKEY LIKE '1955' OR STATIONOFFIRSTENTRYKEY LIKE '1956' OR STATIONOFFIRSTENTRYKEY LIKE '1958' OR STATIONOFFIRSTENTRYKEY LIKE '1959' OR STATIONOFFIRSTENTRYKEY LIKE '1960' OR STATIONOFFIRSTENTRYKEY LIKE '1961' OR STATIONOFFIRSTENTRYKEY LIKE '1962' OR STATIONOFFIRSTENTRYKEY LIKE '1963' OR STATIONOFFIRSTENTRYKEY LIKE '1964' OR STATIONOFFIRSTENTRYKEY LIKE '1965' OR STATIONOFFIRSTENTRYKEY LIKE '1966' OR STATIONOFFIRSTENTRYKEY LIKE '1968' OR STATIONOFFIRSTENTRYKEY LIKE '1969' OR STATIONOFFIRSTENTRYKEY LIKE '1971' OR STATIONOFFIRSTENTRYKEY LIKE '1972' OR STATIONOFFIRSTENTRYKEY LIKE '1973' OR STATIONOFFIRSTENTRYKEY LIKE '1977' OR STATIONOFFIRSTENTRYKEY LIKE '1980' OR STATIONOFFIRSTENTRYKEY LIKE '1984' OR STATIONOFFIRSTENTRYKEY LIKE '1988' OR STATIONOFFIRSTENTRYKEY LIKE '1989' OR STATIONOFFIRSTENTRYKEY LIKE '1995' OR STATIONOFFIRSTENTRYKEY LIKE '2000' OR STATIONOFFIRSTENTRYKEY LIKE '2070' OR STATIONOFFIRSTENTRYKEY LIKE '2117' OR STATIONOFFIRSTENTRYKEY LIKE '2118')")


scala> val sqlFrame = spark.sql("CREATE TABLE tfl_final SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_stage_2 WHERE (STATIONOFEXITKEY LIKE '-1' OR STATIONOFEXITKEY LIKE '1' OR STATIONOFEXITKEY LIKE '2' OR STATIONOFEXITKEY LIKE '3' OR STATIONOFEXITKEY LIKE '4' OR STATIONOFEXITKEY LIKE '5' OR STATIONOFEXITKEY LIKE '6' OR STATIONOFEXITKEY LIKE '7' OR STATIONOFEXITKEY LIKE '8' OR STATIONOFEXITKEY LIKE '9' OR STATIONOFEXITKEY LIKE '10' OR STATIONOFEXITKEY LIKE '11' OR STATIONOFEXITKEY LIKE '12' OR STATIONOFEXITKEY LIKE '13' OR STATIONOFEXITKEY LIKE '14' OR STATIONOFEXITKEY LIKE '15' OR STATIONOFEXITKEY LIKE '16' OR STATIONOFEXITKEY LIKE '17' OR STATIONOFEXITKEY LIKE '18' OR STATIONOFEXITKEY LIKE '19' OR STATIONOFEXITKEY LIKE '20' OR STATIONOFEXITKEY LIKE '21' OR STATIONOFEXITKEY LIKE '22' OR STATIONOFEXITKEY LIKE '23' OR STATIONOFEXITKEY LIKE '24' OR STATIONOFEXITKEY LIKE '25' OR STATIONOFEXITKEY LIKE '26' OR STATIONOFEXITKEY LIKE '27' OR STATIONOFEXITKEY LIKE '28' OR STATIONOFEXITKEY LIKE '30' OR STATIONOFEXITKEY LIKE '31' OR STATIONOFEXITKEY LIKE '32' OR STATIONOFEXITKEY LIKE '33' OR STATIONOFEXITKEY LIKE '34' OR STATIONOFEXITKEY LIKE '35' OR STATIONOFEXITKEY LIKE '36' OR STATIONOFEXITKEY LIKE '37' OR STATIONOFEXITKEY LIKE '38' OR STATIONOFEXITKEY LIKE '39' OR STATIONOFEXITKEY LIKE '40' OR STATIONOFEXITKEY LIKE '41' OR STATIONOFEXITKEY LIKE '42' OR STATIONOFEXITKEY LIKE '43' OR STATIONOFEXITKEY LIKE '44' OR STATIONOFEXITKEY LIKE '45' OR STATIONOFEXITKEY LIKE '46' OR STATIONOFEXITKEY LIKE '47' OR STATIONOFEXITKEY LIKE '48' OR STATIONOFEXITKEY LIKE '49' OR STATIONOFEXITKEY LIKE '50' OR STATIONOFEXITKEY LIKE '51' OR STATIONOFEXITKEY LIKE '52' OR STATIONOFEXITKEY LIKE '53' OR STATIONOFEXITKEY LIKE '54' OR STATIONOFEXITKEY LIKE '55' OR STATIONOFEXITKEY LIKE '56' OR STATIONOFEXITKEY LIKE '57' OR STATIONOFEXITKEY LIKE '59' OR STATIONOFEXITKEY LIKE '60' OR STATIONOFEXITKEY LIKE '61' OR STATIONOFEXITKEY LIKE '62' OR STATIONOFEXITKEY LIKE '63' OR STATIONOFEXITKEY LIKE '64' OR STATIONOFEXITKEY LIKE '65' OR STATIONOFEXITKEY LIKE '66' OR STATIONOFEXITKEY LIKE '67' OR STATIONOFEXITKEY LIKE '68' OR STATIONOFEXITKEY LIKE '69' OR STATIONOFEXITKEY LIKE '70' OR STATIONOFEXITKEY LIKE '71' OR STATIONOFEXITKEY LIKE '72' OR STATIONOFEXITKEY LIKE '73' OR STATIONOFEXITKEY LIKE '74' OR STATIONOFEXITKEY LIKE '76' OR STATIONOFEXITKEY LIKE '77' OR STATIONOFEXITKEY LIKE '78' OR STATIONOFEXITKEY LIKE '79' OR STATIONOFEXITKEY LIKE '80' OR STATIONOFEXITKEY LIKE '81' OR STATIONOFEXITKEY LIKE '82' OR STATIONOFEXITKEY LIKE '83' OR STATIONOFEXITKEY LIKE '84' OR STATIONOFEXITKEY LIKE '85' OR STATIONOFEXITKEY LIKE '86' OR STATIONOFEXITKEY LIKE '87' OR STATIONOFEXITKEY LIKE '88' OR STATIONOFEXITKEY LIKE '89' OR STATIONOFEXITKEY LIKE '90' OR STATIONOFEXITKEY LIKE '92' OR STATIONOFEXITKEY LIKE '93' OR STATIONOFEXITKEY LIKE '94' OR STATIONOFEXITKEY LIKE '95' OR STATIONOFEXITKEY LIKE '96' OR STATIONOFEXITKEY LIKE '97' OR STATIONOFEXITKEY LIKE '98' OR STATIONOFEXITKEY LIKE '99' OR STATIONOFEXITKEY LIKE '100' OR STATIONOFEXITKEY LIKE '101' OR STATIONOFEXITKEY LIKE '102' OR STATIONOFEXITKEY LIKE '103' OR STATIONOFEXITKEY LIKE '104' OR STATIONOFEXITKEY LIKE '105' OR STATIONOFEXITKEY LIKE '106' OR STATIONOFEXITKEY LIKE '107' OR STATIONOFEXITKEY LIKE '109' OR STATIONOFEXITKEY LIKE '110' OR STATIONOFEXITKEY LIKE '111' OR STATIONOFEXITKEY LIKE '112' OR STATIONOFEXITKEY LIKE '113' OR STATIONOFEXITKEY LIKE '115' OR STATIONOFEXITKEY LIKE '116' OR STATIONOFEXITKEY LIKE '117' OR STATIONOFEXITKEY LIKE '118' OR STATIONOFEXITKEY LIKE '119' OR STATIONOFEXITKEY LIKE '120' OR STATIONOFEXITKEY LIKE '121' OR STATIONOFEXITKEY LIKE '122' OR STATIONOFEXITKEY LIKE '123' OR STATIONOFEXITKEY LIKE '124' OR STATIONOFEXITKEY LIKE '125' OR STATIONOFEXITKEY LIKE '126' OR STATIONOFEXITKEY LIKE '127' OR STATIONOFEXITKEY LIKE '128' OR STATIONOFEXITKEY LIKE '129' OR STATIONOFEXITKEY LIKE '130' OR STATIONOFEXITKEY LIKE '131' OR STATIONOFEXITKEY LIKE '132' OR STATIONOFEXITKEY LIKE '133' OR STATIONOFEXITKEY LIKE '134' OR STATIONOFEXITKEY LIKE '135' OR STATIONOFEXITKEY LIKE '136' OR STATIONOFEXITKEY LIKE '137' OR STATIONOFEXITKEY LIKE '138' OR STATIONOFEXITKEY LIKE '139' OR STATIONOFEXITKEY LIKE '141' OR STATIONOFEXITKEY LIKE '142' OR STATIONOFEXITKEY LIKE '143' OR STATIONOFEXITKEY LIKE '144' OR STATIONOFEXITKEY LIKE '145' OR STATIONOFEXITKEY LIKE '146' OR STATIONOFEXITKEY LIKE '147' OR STATIONOFEXITKEY LIKE '148' OR STATIONOFEXITKEY LIKE '149' OR STATIONOFEXITKEY LIKE '150' OR STATIONOFEXITKEY LIKE '151' OR STATIONOFEXITKEY LIKE '152' OR STATIONOFEXITKEY LIKE '153' OR STATIONOFEXITKEY LIKE '154' OR STATIONOFEXITKEY LIKE '155' OR STATIONOFEXITKEY LIKE '156' OR STATIONOFEXITKEY LIKE '157' OR STATIONOFEXITKEY LIKE '158' OR STATIONOFEXITKEY LIKE '159' OR STATIONOFEXITKEY LIKE '160' OR STATIONOFEXITKEY LIKE '161' OR STATIONOFEXITKEY LIKE '162' OR STATIONOFEXITKEY LIKE '163' OR STATIONOFEXITKEY LIKE '164' OR STATIONOFEXITKEY LIKE '166' OR STATIONOFEXITKEY LIKE '167' OR STATIONOFEXITKEY LIKE '168' OR STATIONOFEXITKEY LIKE '169' OR STATIONOFEXITKEY LIKE '171' OR STATIONOFEXITKEY LIKE '172' OR STATIONOFEXITKEY LIKE '173' OR STATIONOFEXITKEY LIKE '175' OR STATIONOFEXITKEY LIKE '176' OR STATIONOFEXITKEY LIKE '177' OR STATIONOFEXITKEY LIKE '178' OR STATIONOFEXITKEY LIKE '179' OR STATIONOFEXITKEY LIKE '183' OR STATIONOFEXITKEY LIKE '187' OR STATIONOFEXITKEY LIKE '188' OR STATIONOFEXITKEY LIKE '189' OR STATIONOFEXITKEY LIKE '190' OR STATIONOFEXITKEY LIKE '191' OR STATIONOFEXITKEY LIKE '192' OR STATIONOFEXITKEY LIKE '193' OR STATIONOFEXITKEY LIKE '194' OR STATIONOFEXITKEY LIKE '195' OR STATIONOFEXITKEY LIKE '196' OR STATIONOFEXITKEY LIKE '197' OR STATIONOFEXITKEY LIKE '198' OR STATIONOFEXITKEY LIKE '199' OR STATIONOFEXITKEY LIKE '200' OR STATIONOFEXITKEY LIKE '201' OR STATIONOFEXITKEY LIKE '202' OR STATIONOFEXITKEY LIKE '203' OR STATIONOFEXITKEY LIKE '205' OR STATIONOFEXITKEY LIKE '206' OR STATIONOFEXITKEY LIKE '207' OR STATIONOFEXITKEY LIKE '208' OR STATIONOFEXITKEY LIKE '209' OR STATIONOFEXITKEY LIKE '210' OR STATIONOFEXITKEY LIKE '211' OR STATIONOFEXITKEY LIKE '213' OR STATIONOFEXITKEY LIKE '214' OR STATIONOFEXITKEY LIKE '215' OR STATIONOFEXITKEY LIKE '216' OR STATIONOFEXITKEY LIKE '217' OR STATIONOFEXITKEY LIKE '218' OR STATIONOFEXITKEY LIKE '219' OR STATIONOFEXITKEY LIKE '220' OR STATIONOFEXITKEY LIKE '221' OR STATIONOFEXITKEY LIKE '222' OR STATIONOFEXITKEY LIKE '223' OR STATIONOFEXITKEY LIKE '224' OR STATIONOFEXITKEY LIKE '225' OR STATIONOFEXITKEY LIKE '227' OR STATIONOFEXITKEY LIKE '228' OR STATIONOFEXITKEY LIKE '229' OR STATIONOFEXITKEY LIKE '231' OR STATIONOFEXITKEY LIKE '232' OR STATIONOFEXITKEY LIKE '233' OR STATIONOFEXITKEY LIKE '234' OR STATIONOFEXITKEY LIKE '235' OR STATIONOFEXITKEY LIKE '236' OR STATIONOFEXITKEY LIKE '237' OR STATIONOFEXITKEY LIKE '238' OR STATIONOFEXITKEY LIKE '239' OR STATIONOFEXITKEY LIKE '240' OR STATIONOFEXITKEY LIKE '241' OR STATIONOFEXITKEY LIKE '242' OR STATIONOFEXITKEY LIKE '243' OR STATIONOFEXITKEY LIKE '244' OR STATIONOFEXITKEY LIKE '245' OR STATIONOFEXITKEY LIKE '246' OR STATIONOFEXITKEY LIKE '247' OR STATIONOFEXITKEY LIKE '248' OR STATIONOFEXITKEY LIKE '249' OR STATIONOFEXITKEY LIKE '251' OR STATIONOFEXITKEY LIKE '252' OR STATIONOFEXITKEY LIKE '254' OR STATIONOFEXITKEY LIKE '255' OR STATIONOFEXITKEY LIKE '256' OR STATIONOFEXITKEY LIKE '257' OR STATIONOFEXITKEY LIKE '261' OR STATIONOFEXITKEY LIKE '262' OR STATIONOFEXITKEY LIKE '263' OR STATIONOFEXITKEY LIKE '264' OR STATIONOFEXITKEY LIKE '267' OR STATIONOFEXITKEY LIKE '268' OR STATIONOFEXITKEY LIKE '269' OR STATIONOFEXITKEY LIKE '284' OR STATIONOFEXITKEY LIKE '299' OR STATIONOFEXITKEY LIKE '302' OR STATIONOFEXITKEY LIKE '303' OR STATIONOFEXITKEY LIKE '318' OR STATIONOFEXITKEY LIKE '336' OR STATIONOFEXITKEY LIKE '338' OR STATIONOFEXITKEY LIKE '373' OR STATIONOFEXITKEY LIKE '384' OR STATIONOFEXITKEY LIKE '393' OR STATIONOFEXITKEY LIKE '402' OR STATIONOFEXITKEY LIKE '431' OR STATIONOFEXITKEY LIKE '449' OR STATIONOFEXITKEY LIKE '454' OR STATIONOFEXITKEY LIKE '462' OR STATIONOFEXITKEY LIKE '463' OR STATIONOFEXITKEY LIKE '489' OR STATIONOFEXITKEY LIKE '493' OR STATIONOFEXITKEY LIKE '521' OR STATIONOFEXITKEY LIKE '526' OR STATIONOFEXITKEY LIKE '538' OR STATIONOFEXITKEY LIKE '587' OR STATIONOFEXITKEY LIKE '602' OR STATIONOFEXITKEY LIKE '606' OR STATIONOFEXITKEY LIKE '608' OR STATIONOFEXITKEY LIKE '610' OR STATIONOFEXITKEY LIKE '643' OR STATIONOFEXITKEY LIKE '644' OR STATIONOFEXITKEY LIKE '662' OR STATIONOFEXITKEY LIKE '670' OR STATIONOFEXITKEY LIKE '671' OR STATIONOFEXITKEY LIKE '691' OR STATIONOFEXITKEY LIKE '701' OR STATIONOFEXITKEY LIKE '708' OR STATIONOFEXITKEY LIKE '717' OR STATIONOFEXITKEY LIKE '744' OR STATIONOFEXITKEY LIKE '745' OR STATIONOFEXITKEY LIKE '752' OR STATIONOFEXITKEY LIKE '765' OR STATIONOFEXITKEY LIKE '789' OR STATIONOFEXITKEY LIKE '791' OR STATIONOFEXITKEY LIKE '822' OR STATIONOFEXITKEY LIKE '825' OR STATIONOFEXITKEY LIKE '861' OR STATIONOFEXITKEY LIKE '870' OR STATIONOFEXITKEY LIKE '871' OR STATIONOFEXITKEY LIKE '872' OR STATIONOFEXITKEY LIKE '876' OR STATIONOFEXITKEY LIKE '882' OR STATIONOFEXITKEY LIKE '903' OR STATIONOFEXITKEY LIKE '910' OR STATIONOFEXITKEY LIKE '915' OR STATIONOFEXITKEY LIKE '918' OR STATIONOFEXITKEY LIKE '930' OR STATIONOFEXITKEY LIKE '932' OR STATIONOFEXITKEY LIKE '974' OR STATIONOFEXITKEY LIKE '981' OR STATIONOFEXITKEY LIKE '1123' OR STATIONOFEXITKEY LIKE '1124' OR STATIONOFEXITKEY LIKE '1293' OR STATIONOFEXITKEY LIKE '1294' OR STATIONOFEXITKEY LIKE '1295' OR STATIONOFEXITKEY LIKE '1335' OR STATIONOFEXITKEY LIKE '1337' OR STATIONOFEXITKEY LIKE '1338' OR STATIONOFEXITKEY LIKE '1339' OR STATIONOFEXITKEY LIKE '1341' OR STATIONOFEXITKEY LIKE '1342' OR STATIONOFEXITKEY LIKE '1343' OR STATIONOFEXITKEY LIKE '1345' OR STATIONOFEXITKEY LIKE '1348' OR STATIONOFEXITKEY LIKE '1349' OR STATIONOFEXITKEY LIKE '1350' OR STATIONOFEXITKEY LIKE '1351' OR STATIONOFEXITKEY LIKE '1352' OR STATIONOFEXITKEY LIKE '1355' OR STATIONOFEXITKEY LIKE '1356' OR STATIONOFEXITKEY LIKE '1357' OR STATIONOFEXITKEY LIKE '1365' OR STATIONOFEXITKEY LIKE '1366' OR STATIONOFEXITKEY LIKE '1367' OR STATIONOFEXITKEY LIKE '1368' OR STATIONOFEXITKEY LIKE '1371' OR STATIONOFEXITKEY LIKE '1378' OR STATIONOFEXITKEY LIKE '1409' OR STATIONOFEXITKEY LIKE '1486' OR STATIONOFEXITKEY LIKE '1510' OR STATIONOFEXITKEY LIKE '1521' OR STATIONOFEXITKEY LIKE '1572' OR STATIONOFEXITKEY LIKE '1577' OR STATIONOFEXITKEY LIKE '1615' OR STATIONOFEXITKEY LIKE '1616' OR STATIONOFEXITKEY LIKE '1617' OR STATIONOFEXITKEY LIKE '1618' OR STATIONOFEXITKEY LIKE '1619' OR STATIONOFEXITKEY LIKE '1620' OR STATIONOFEXITKEY LIKE '1679' OR STATIONOFEXITKEY LIKE '1680' OR STATIONOFEXITKEY LIKE '1681' OR STATIONOFEXITKEY LIKE '1682' OR STATIONOFEXITKEY LIKE '1683' OR STATIONOFEXITKEY LIKE '1685' OR STATIONOFEXITKEY LIKE '1686' OR STATIONOFEXITKEY LIKE '1688' OR STATIONOFEXITKEY LIKE '1731' OR STATIONOFEXITKEY LIKE '1946' OR STATIONOFEXITKEY LIKE '1955' OR STATIONOFEXITKEY LIKE '1956' OR STATIONOFEXITKEY LIKE '1958' OR STATIONOFEXITKEY LIKE '1959' OR STATIONOFEXITKEY LIKE '1960' OR STATIONOFEXITKEY LIKE '1961' OR STATIONOFEXITKEY LIKE '1962' OR STATIONOFEXITKEY LIKE '1963' OR STATIONOFEXITKEY LIKE '1964' OR STATIONOFEXITKEY LIKE '1965' OR STATIONOFEXITKEY LIKE '1966' OR STATIONOFEXITKEY LIKE '1968' OR STATIONOFEXITKEY LIKE '1969' OR STATIONOFEXITKEY LIKE '1971' OR STATIONOFEXITKEY LIKE '1972' OR STATIONOFEXITKEY LIKE '1973' OR STATIONOFEXITKEY LIKE '1977' OR STATIONOFEXITKEY LIKE '1980' OR STATIONOFEXITKEY LIKE '1984' OR STATIONOFEXITKEY LIKE '1988' OR STATIONOFEXITKEY LIKE '1989' OR STATIONOFEXITKEY LIKE '1995' OR STATIONOFEXITKEY LIKE '2000' OR STATIONOFEXITKEY LIKE '2070' OR STATIONOFEXITKEY LIKE '2117' OR STATIONOFEXITKEY LIKE '2118')")


# Now that we have a final, filtered dataset which contains only the fields we want and journeys that take place only on tube or rail services, we can get the frequency distribution of key variables, as follows:

# Get the frequency of journeys for each day

scala> val sqlFrame = spark.sql("SELECT DAYKEY, COUNT(DAYKEY) AS Frequency, COUNT(DAYKEY)/(SELECT COUNT(DAYKEY) FROM tfl_final)*100 AS Percentage FROM tfl_final GROUP BY DAYKEY ORDER BY Frequency DESC")

scala> sqlFrame.show(1000)



# CREATING A SAMPLE DATASET

# Now, based on the frequency distribution of journeys taken on each day, we can get a sample of records from the entire TfL dataset. To do so, we get a random sample of records from each day based on 
the frequency of journeys occurring on each day, using the following queries:


scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12393 ORDER BY RAND() LIMIT 101443")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12393 ORDER BY RAND() LIMIT 101443")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12386 ORDER BY RAND() LIMIT 101069")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12400 ORDER BY RAND() LIMIT 99259")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12399 ORDER BY RAND() LIMIT 97878")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12391 ORDER BY RAND() LIMIT 97638")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12398 ORDER BY RAND() LIMIT 97433")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12392 ORDER BY RAND() LIMIT 96895")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12385 ORDER BY RAND() LIMIT 96820")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12379 ORDER BY RAND() LIMIT 95575")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12372 ORDER BY RAND() LIMIT 95231")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12383 ORDER BY RAND() LIMIT 94683")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12378 ORDER BY RAND() LIMIT 94200")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12397 ORDER BY RAND() LIMIT 93657")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12376 ORDER BY RAND() LIMIT 92467")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12384 ORDER BY RAND() LIMIT 92320")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12371 ORDER BY RAND() LIMIT 92029")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12364 ORDER BY RAND() LIMIT 91877")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12390 ORDER BY RAND() LIMIT 91800")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12370 ORDER BY RAND() LIMIT 90649")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12365 ORDER BY RAND() LIMIT 90261")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12356 ORDER BY RAND() LIMIT 90035")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12377 ORDER BY RAND() LIMIT 89734")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12355 ORDER BY RAND() LIMIT 89598")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12351 ORDER BY RAND() LIMIT 89589")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12357 ORDER BY RAND() LIMIT 89305")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12363 ORDER BY RAND() LIMIT 88787")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12369 ORDER BY RAND() LIMIT 88752")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12358 ORDER BY RAND() LIMIT 88577")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12350 ORDER BY RAND() LIMIT 88562")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12362 ORDER BY RAND() LIMIT 86968")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12348 ORDER BY RAND() LIMIT 86673")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12349 ORDER BY RAND() LIMIT 86623")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12396 ORDER BY RAND() LIMIT 85164")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12389 ORDER BY RAND() LIMIT 84522")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12382 ORDER BY RAND() LIMIT 81450")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12368 ORDER BY RAND() LIMIT 80320")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12375 ORDER BY RAND() LIMIT 79487")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12347 ORDER BY RAND() LIMIT 78539")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12361 ORDER BY RAND() LIMIT 77558")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12354 ORDER BY RAND() LIMIT 68538")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12387 ORDER BY RAND() LIMIT 50084")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12401 ORDER BY RAND() LIMIT 50006")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12394 ORDER BY RAND() LIMIT 47452")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12373 ORDER BY RAND() LIMIT 40869")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12366 ORDER BY RAND() LIMIT 39785")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12359 ORDER BY RAND() LIMIT 39436")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12352 ORDER BY RAND() LIMIT 38013")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12380 ORDER BY RAND() LIMIT 36506")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12395 ORDER BY RAND() LIMIT 23930")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12388 ORDER BY RAND() LIMIT 22239")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12353 ORDER BY RAND() LIMIT 19777")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12367 ORDER BY RAND() LIMIT 18227")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12381 ORDER BY RAND() LIMIT 17468")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12374 ORDER BY RAND() LIMIT 16828")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12360 ORDER BY RAND() LIMIT 16150")

scala> val sqlFrame = spark.sql("SELECT PRESTIGEID, PPTPASSENGERAGEKEY, DAYKEY, CARDTYPEKEY, STATIONOFFIRSTENTRYKEY, STATIONOFEXITKEY, TRANSACTIONTIME FROM tfl_final WHERE DAYKEY LIKE 12346 ORDER BY RAND() LIMIT 13334")













 


